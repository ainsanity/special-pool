<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Customer Contract Settlement Tool</title>

<style>
body { font-family: Arial, sans-serif; background:#f4f6f9; padding:20px; }
h2 { margin-bottom:10px; }
input, button { padding:8px; font-size:14px; }
button { margin-left:6px; cursor:pointer; }

.summary, table {
  background:#fff;
  padding:15px;
  border-radius:8px;
  margin-top:15px;
}

table { width:100%; border-collapse:collapse; }
th, td {
  padding:8px;
  border-bottom:1px solid #ddd;
  text-align:center;
  font-size:13px;
}
th { background:#2c3e50; color:white; }

.gnpa { color:red; font-weight:bold; }
.non { color:green; font-weight:bold; }
.manager { color:#e67e22; font-weight:bold; }

#error {
  color:red;
  font-weight:bold;
  margin-top:10px;
}
</style>
</head>

<body>

<h2>Search by Contract No</h2>

<input id="contractInput" placeholder="Enter Contract No">
<button onclick="searchContract()">Search</button>

<div id="error"></div>
<div class="summary" id="summary"></div>

<table id="tbl" style="display:none">
<thead>
<tr>
  <th>Contract No</th>
  <th>GNPA Flag</th>
  <th>Seasoning %</th>
  <th>Contract Balance Jan-26</th>
  <th>Settlement Offer</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
// ðŸ”´ YOUR ACTUAL RAW JSON URL
const RAW_JSON_URL =
  "https://raw.githubusercontent.com/ainsanity/special-pool/main/output.json";

let customers = [];
let contracts = [];
let loaded = false;

/* ================= LOAD JSON ================= */
fetch(RAW_JSON_URL)
  .then(res => res.json())
  .then(data => {
    customers = data.customers;
    contracts = data.contracts;
    loaded = true;
    console.log("Loaded contracts:", contracts.length);
  })
  .catch(err => {
    document.getElementById("error").innerText =
      "âŒ Failed to load JSON. Check RAW URL.";
  });

/* ================= SETTLEMENT LOGIC ================= */
function settlement(seasoning, balance, lsa) {
  if (lsa === "YES") return "Contact Manager";
  if (seasoning >= 60) return Math.round(balance * 0.75);
  if (seasoning >= 30) return Math.round(balance * 0.55);
  return Math.round(balance * 0.40);
}

/* ================= SEARCH ================= */
function searchContract() {
  document.getElementById("error").innerText = "";
  document.getElementById("tbl").style.display = "none";

  if (!loaded) {
    document.getElementById("error").innerText = "Data still loading...";
    return;
  }

  const input = document.getElementById("contractInput").value.trim().toUpperCase();
  if (!input) {
    document.getElementById("error").innerText = "Please enter a Contract No";
    return;
  }

  const found = contracts.find(c =>
    String(c.contract_no).trim().toUpperCase() === input
  );

  if (!found) {
    document.getElementById("error").innerText = "âŒ Contract not found";
    return;
  }

  const customer = customers.find(c => c.customer_id === found.customer_id);
  const linked = contracts.filter(c => c.customer_id === found.customer_id);

  document.getElementById("summary").innerHTML = `
    <div><b>Customer:</b> ${customer.customer_name}</div>
    <div><b>Total Contracts:</b> ${linked.length}</div>
    <div><b>GNPA:</b> ${linked.filter(c=>c.gnpa_flag==="YES").length}</div>
    <div><b>Non-GNPA:</b> ${linked.filter(c=>c.gnpa_flag!=="YES").length}</div>
    <div><b>LSA:</b> ${customer.lsa_flag==="YES" ? linked.length : 0}</div>
  `;

  document.getElementById("tbody").innerHTML = linked.map(c => `
    <tr>
      <td>${c.contract_no}</td>
      <td class="${c.gnpa_flag==="YES" ? "gnpa" : "non"}">${c.gnpa_flag}</td>
      <td>${c.seasoning_pct}</td>
      <td>${c.contract_balance_jan_26}</td>
      <td>${settlement(
        c.seasoning_pct,
        c.contract_balance_jan_26,
        customer.lsa_flag
      )}</td>
    </tr>
  `).join("");

  document.getElementById("tbl").style.display = "table";
}
</script>

</body>
</html>
